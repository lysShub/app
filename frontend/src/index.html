<!DOCTYPE html>
<html class="" lang="zh">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge, Chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
  <!-- Main Source Files -->
  <link rel="stylesheet" href="main.css" />
  <!-- <link rel="stylesheet" href="./tailwind.css"> -->

  <!-- <script src="https://cdn.tailwindcss.com"></script> -->
  <script src="./main.js"></script>
  <script src="./wails/runtime.js"></script>
  <script src="./echarts.min.js"></script>
  <script>


    // function test() {
    //   var elem = document.getElementsByClassName('search-game-grid-item')[0];
    //   var newElem = elem.cloneNode(true);
    //   elem.parentElement.appendChild(newElem);
    //   console.log(elem.innerHTML);
    // }
  </script>
</head>

<body class="body">
  <div class="side-bar">

    <div class="games">
      <div class="games-list">

        <div class="games-item">
          <img class="games-item-icon" src="./assets/images/images/pubg-icon.png" />
          <p class="games-item-name">战争雷霆 (国际服)</p>
        </div>
        <div class="games-item">
          <img class="games-item-icon" src="./assets/images/images/csgo-icon.png" />
          <p class="games-item-name">反恐精英</p>
        </div>
        <div class="games-item">
          <img class="games-item-icon" src="./assets/images/images/dnf-icon.png" />
          <p class="games-item-name">地下城与勇士</p>
        </div>

      </div>

      <div class="games-add">
        <div onclick="console.log(123)" class="games-add-item">&nbsp;&nbsp;&nbsp;＋&nbsp;添加游戏 </div>
      </div>
    </div>

    <div class="user-info">
      <img class="user-info-icon" src="./assets/images/logo-universal.png">
      <div class="user-info-detail">
        <div class="user-info-nickname">test</div>
        <div class="user-info-subscribe">
          <p>到期:&nbsp;&nbsp;</p>
          <p id="subscribe">2024年12月26日</p>
        </div>
      </div>
    </div>

  </div>

  <div class="main-body">

    <!-- 搜索游戏并添加 -->
    <div class="search-game">
      <input class="search-game-input" placeholder="搜索游戏关键字">
      <div class="search-game-grid">

        <div class="search-game-grid-item">
          <img class="search-game-grid-item-ad" src="assets/images/images/pubg-ad.png">
          <div class="search-game-grid-item-name">绝地求生</div>
          <div class="search-game-grid-item-focus">
            <img onclick="" class="search-game-grid-item-focus-icon" src="assets/images/add.png">
          </div>
        </div>

      </div>
    </div>

    <!-- 游戏详情页 -->
    <div class="game-detail">
      <img class="game-detail-bg" src="assets/images/images/dnf-bg.jpg"></img>
      <div class="game-detail-body">

        <div class="game-detail-body-title">
          <div class="game-detail-body-title-name">战争雷霆 (国际服)</div>
          <div class="game-detail-body-title-info">
            最近加速:&nbsp;
            <div id="game-detail-body-title-info-recent">
              2024年8月26日 15:38:11
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;累计加速:&nbsp;
            <div id="game-detail-body-title-info-total">
              13
            </div>
            小时
          </div>
        </div>

        <div class="game-detail-body-acc">
          <div class="game-detail-body-acc-setting">

            <select class="game-detail-body-acc-setting-zone">
              <option value="option3">北美服</option>
              <option value="option1">亚服</option>
              <option value="option2">俄服</option>
            </select>


            <ul class="game-detail-body-acc-setting-route">
              <script type="text/javascript">
                var routeMode = 'auto';
                function updateRouteMode(id) {
                  console.log(id);
                  if (id == 'route-mode-auto') {
                    routeMode = 'auto';
                    document.getElementById('route-mode-auto').style.listStyleType = 'disc';
                    document.getElementById('route-mode-fix').style.listStyleType = 'circle';
                  } else {
                    routeMode = 'fix';
                    document.getElementById('route-mode-auto').style.listStyleType = 'circle';
                    document.getElementById('route-mode-fix').style.listStyleType = 'disc';
                  }
                }
              </script>
              <li onclick="updateRouteMode(this.id)" name="route-mode" id="route-mode-auto" style="list-style-type: disc; cursor: pointer;">智能路由</li>
              <li onclick="updateRouteMode(this.id)" name="route-mode" id="route-mode-fix" style="list-style-type: circle; cursor: pointer;">固定路由</li>
            </ul>
          </div>

          <div class="game-detail-body-acc-start">
            <img src="assets/images/accelerate.png" class="game-detail-body-acc-start-icon">
            <div class="game-detail-body-acc-start-text">加速游戏</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 加速中 -->
    <div class="accelerate">

      <div class="accelerate-detail">
        <img class="accelerate-detail-img" src="assets/images/images/pubg-ad.png">

        <div class="accelerate-detail-base">
          <div class="accelerate-detail-base-info">
            <div class="accelerate-detail-base-info-title">
              <div class="accelerate-detail-base-info-title-name">战争雷霆(国际服)</div>

              <div class="accelerate-detail-base-info-title-stats">
                加速时长:&nbsp;
                <div class="accelerate-detail-base-info-title-stats-duration">00:46:54</div>
                &nbsp;&nbsp;&nbsp;&nbsp;加速流量:&nbsp;
                <div class="accelerate-detail-base-info-title-stats-bytes">99.0KB</div>
              </div>
            </div>

            <div class="accelerate-detail-base-info-stop">停止加速</div>
          </div>

          <div class="accelerate-detail-base-route">

            <svg t="1724786337168" class="accelerate-detail-base-route-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18463" width="48" height="48">
              <path d="M306.688 624a93.312 93.312 0 1 1 0 186.666667 93.312 93.312 0 0 1 0-186.666667z m0 42.666667a50.688 50.688 0 1 0 0 101.333333 50.688 50.688 0 0 0 0-101.333333zM381.354667 288a93.354667 93.354667 0 1 1 0 186.666667 93.354667 93.354667 0 0 1 0-186.666667z m0 42.666667a50.688 50.688 0 1 0 0 101.333333 50.688 50.688 0 0 0 0-101.333333zM642.688 549.333333a93.312 93.312 0 1 1 0 186.666667 93.312 93.312 0 0 1 0-186.666667z m0 42.666667a50.688 50.688 0 1 0 0 101.333333 50.688 50.688 0 0 0 0-101.333333zM717.354667 213.333333a93.312 93.312 0 1 1 0 186.666667 93.312 93.312 0 0 1 0-186.666667z m0 42.666667a50.688 50.688 0 1 0 0 101.333333 50.688 50.688 0 0 0 0-101.333333z" p-id="18464"></path>
              <path d="M692.437333 355.456l41.386667 10.368-56.96 227.797333-41.386667-10.368zM452.394667 423.594667l148.693333 149.248-30.250667 30.122666-148.693333-149.248zM341.76 441.898667l41.813333 8.106666-40.106666 206.250667-41.856-8.149333z" p-id="18465"></path>
            </svg>
            <div>本机</div>
            <svg t="1724787454585" class="accelerate-detail-base-route-arrow" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="45364" width="48" height="48">
              <path d="M 18.204 494.364 l 917.049 0 l 0 35.2711 l -917.049 0 l 0 -35.2711 Z" p-id="45365"></path>
              <path d="M 829.44 459.094 L 1005.79 512 L 829.44 564.906 Z" p-id="45366"></path>
            </svg>
            <div id="route-link-gateway">北京</div>
            <svg t="1724787454585" class="accelerate-detail-base-route-arrow" id="accelerate-detail-base-route-arrow-acc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="45364" width="48" height="48">
              <path d="M 18.204 494.364 l 917.049 0 l 0 35.2711 l -917.049 0 l 0 -35.2711 Z" p-id="45365"></path>
              <path d="M 829.44 459.094 L 1005.79 512 L 829.44 564.906 Z" p-id="45366"></path>
            </svg>
            <div id="route-link-forward">莫斯科</div>
            <svg t="1724787454585" class="accelerate-detail-base-route-arrow" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="45364" width="48" height="48">
              <path d="M 18.204 494.364 l 917.049 0 l 0 35.2711 l -917.049 0 l 0 -35.2711 Z" p-id="45365"></path>
              <path d="M 829.44 459.094 L 1005.79 512 L 829.44 564.906 Z" p-id="45366"></path>
            </svg>
            <div id="route-link-server">圣彼得堡</div>

          </div>
        </div>
      </div>


      <div class="accelerate-chart" id="accelerate-chart-delay"> </div>

      <!-- <div class="accelerate-footer"> 延迟&nbsp;(ms) </div> -->

      <div class="accelerate-chart" id="accelerate-chart-loss"> </div>

      <!-- <div class="accelerate-footer">
        ○&nbsp;上行&nbsp;&nbsp; ○&nbsp;下行&nbsp;&nbsp; ○&nbsp;合计
      </div> -->

    </div>

  </div>

</body>

<footer>
  <script type="text/javascript">



    class Stats {
      constructor() {
        this.period = 3000 // 数据点间隔 3s
        this.count = 20
        this.delay_id = "accelerate-chart-delay"
        this.loss_id = "accelerate-chart-loss"
        this.gateway_id = "route-link-gateway"
        this.forward_id = "route-link-forward"
        this.server_id = "route-link-server"
        this.color = ['rgb(5,115,205)', 'rgb(255,137,2)']

        this.delay = (function (ctx) {
          var chart = echarts.init(document.getElementById(ctx.delay_id))

          var option = {
            title: {
              text: '延迟 (ms)',
              textStyle: { color: "#fafafa", fontSize: '12', fontWeight: 'normal' },
              bottom: '0px', left: 'center',
            },
            color: ctx.color,
            tooltip: {
              trigger: 'axis',
              confine: true,
              formatter: function (params) {
                console.log(params)
                var time = params[0].data[0]
                var h = time.getHours().toString().padStart(2, '0')
                var m = time.getMinutes().toString().padStart(2, '0')
                var s = time.getSeconds().toString().padStart(2, '0')

                var gateway = params[0].data[1] === null ? 'null' : (params[0].data[1]).toString()
                var forward = params[1].data[1] === null ? 'null' : (params[1].data[1]).toString()
                var gateway_loc = params[0].data[2]
                var forward_loc = params[1].data[2]

                return `
                  <div style="font-size:xx-small;">
                    <div>${h}:${m}:${s}</div>
                    <div style="color:${ctx.color[1]}">本机&nbsp;-&nbsp;${forward_loc}: ${forward}&nbsp;ms</div>
                    <div style="color:${ctx.color[0]}">本机&nbsp;-&nbsp;${gateway_loc}: ${gateway}&nbsp;ms</div>
                  </div>
                `
              },
            },
            xAxis: { type: 'time', show: false, },
            yAxis: {
              type: 'value',
              splitLine: { show: true, lineStyle: { color: '#525359' } },
              axisLabel: { formatter: '{value}ms' }
            },
            series: [],
            grid: { left: '50px', right: '6px', top: '15px', bottom: '30px', }
          };


          var series = ['gateway', 'forward']
          for (let i = 0; i < series.length; i++) {
            option.series.push(
              {
                name: series[i], type: 'line', animationDuration: 400,
                smooth: 0.4, data: [],
                lineStyle: { width: 1 },
                itemStyle: { opacity: 0.2 },
              }
            )
          }
          chart.setOption(option)
          return chart
        })(this)

        this.loss = (function (ctx) {
          var chart = echarts.init(document.getElementById(ctx.loss_id));
          var names = ['上行丢包', '下行丢包']

          var option = {
            color: ctx.color,
            tooltip: {
              trigger: 'axis',
              confine: true,
              formatter: function (params) {
                // console.log(params)

                var time = params[0].data[0]
                var h = time.getHours().toString().padStart(2, '0')
                var m = time.getMinutes().toString().padStart(2, '0')
                var s = time.getSeconds().toString().padStart(2, '0')

                var loss1 = params[0].data[1] === null ? 'null' : (params[0].data[1]).toString()
                var loss2 = params[1].data[1] === null ? 'null' : (params[1].data[1]).toString()
                var gateway_loc = params[0].data[2]
                var forward_loc = params[1].data[2]

                if (params[0].seriesName == names[0]) {
                  return `
                    <div style="font-size:xx-small;">
                      <div>${h}:${m}:${s}</div>
                      <div style="color:${ctx.color[0]}">本机&nbsp;-&nbsp;${gateway_loc}: ${loss1}%</div>
                      <div style="color:${ctx.color[1]}">${gateway_loc}&nbsp;-&nbsp;${forward_loc}: ${loss2}%</div>
                    </div>
                  `
                } else {
                  return `
                    <div style="font-size:xx-small;">
                      <div>${h}:${m}:${s}</div>
                      <div style="color:${ctx.color[1]}">${forward_loc}&nbsp;-&nbsp;${gateway_loc}: ${loss2}&nbsp;%</div>
                      <div style="color:${ctx.color[0]}">${gateway_loc}&nbsp;-&nbsp;本机: ${loss1}&nbsp;%</div>
                    </div>
                  `
                }
              },
            },
            legend: {
              type: 'plain', data: names,
              bottom: '0px', icon: 'none',
              textStyle: { color: '#fafafa', fontSize: '12' },
              selected: { "下行丢包": false },
              selectedMode: 'single',
            },

            xAxis: { type: 'time', show: false, },
            yAxis: {
              type: 'value', min: 0, //max: 100,
              splitLine: { show: true, lineStyle: { color: '#525359' } },
              axisLabel: { formatter: '{value}%' }
            },
            series: [],
            grid: { left: '50px', right: '6px', top: '15px', bottom: '30px', }
          };

          var start = new Date((new Date()).getTime() - (ctx.count - 1) * ctx.period);
          for (let i = 0; i < names.length; i++) {
            for (let j = 0; j < 2; j++) {
              option.series.push(
                {
                  name: names[i], type: 'line', animationDuration: 400,
                  smooth: 0.4, data: [],
                  lineStyle: { width: 1 },
                  itemStyle: { opacity: 0.2, color: ctx.color[j] },
                }
              )
            }
          }

          chart.setOption(option)
          return chart
        })(this)
      }

      // 更新统计数据
      push(stats) {
        {
          var f = function (v) {
            return v == null ? " ? ? " : v
          }
          stats.gateway_loc = f(stats.gateway_loc)
          stats.forward_loc = f(stats.forward_loc)
          stats.server_loc = f(stats.server_loc)

          document.getElementById(this.gateway_id).innerText = stats.gateway_loc
          document.getElementById(this.forward_id).innerText = stats.forward_loc
          document.getElementById(this.server_id).innerText = stats.server_loc
        }
        {
          var opt = this.delay.getOption()
          opt.xAxis = {
            min: new Date(stats.time.getTime() - this.count * this.period),
          }

          var f = function (v) {
            return v == null || v < 0.000001 || v > 300 ? null : v.toFixed(1)
          }
          opt.series[0].data.push([stats.time, f(stats.rtt_gateway), stats.gateway_loc])
          opt.series[1].data.push([stats.time, f(stats.rtt_forward), stats.forward_loc])
          this.delay.setOption(opt)
        }
        {
          var opt = this.loss.getOption()
          opt.xAxis = {
            min: new Date(stats.time.getTime() - this.count * this.period),
          }

          var f = function (v) {
            return v == null || v < 0.000001 || v > 100 ? null : v.toFixed(1)
          }
          opt.series[0].data.push([stats.time, f(stats.loss_client_uplink), stats.gateway_loc])
          opt.series[1].data.push([stats.time, f(stats.loss_client_downlink), stats.forward_loc])
          opt.series[2].data.push([stats.time, f(stats.loss_gateway_uplink), stats.gateway_loc])
          opt.series[3].data.push([stats.time, f(stats.loss_gateway_downlink), stats.forward_loc])
          this.loss.setOption(opt)
        }
      }
    }

    var stats = new Stats()

    worker = new Worker('worker.js');
    worker.onmessage = function (e) {

      var rtt_gateay = 400
      var loss_g_d = 0
      if ((new Date().getSeconds() % 10 != 9)) {
        rtt_gateay = Math.random() * 100
        loss_g_d = Math.random()
      }

      stats.push({
        time: new Date(),
        gateway_loc: '北京',
        forward_loc: '莫斯科',
        server_loc: '圣彼得堡',

        rtt_gateway: rtt_gateay,
        rtt_forward: (100 + Math.random() * 50),

        loss_client_uplink: Math.random() * 3,
        loss_client_downlink: Math.random() * 1,
        loss_gateway_uplink: Math.random(),
        loss_gateway_downlink: loss_g_d,
      })
    }
    worker.postMessage(stats.period) // start

  </script>
</footer>

</html>